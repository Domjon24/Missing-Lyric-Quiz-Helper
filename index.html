<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    
    <title>Login/Signup Form</title>
</head>
<body>
  <div class="container">
    <h2 class="text-center mt-5 mb-3">Lyric Quiz Helper</h2>
    <p class="text-center mb-5">Get help with your lyric quizzes!</p>

    <div class="row justify-content-center align-items-start mt-5 w-100">
      <div class="col-md-7">
        <div class="card w-100">
          <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
            <li class="nav-item text-center">
              <a class="nav-link active btl" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true">Paste Lyrics</a>
            </li>
            <li class="nav-item text-center">
              <a class="nav-link btr" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false">Lyric Lookup</a>
            </li>
          </ul>
          <div class="tab-content" id="pills-tabContent">
            <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
              <div class="form px-4 pt-5">
                <input type="number" name="" class="form-control" placeholder="Word Length" max="99" id="length">
                <textarea rows="5" class="form-control" id="test-input" placeholder="Paste Lyrics Here..."></textarea>
                <button class="btn btn-dark btn-block" id="find-btn" type="submit">Find</button>
              </div>
            </div>
            <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
              <div class="form px-4">
                <input type="text" name="Artist" class="form-control" placeholder="Artist" id="artist">
                <input type="text" name="Title" class="form-control" placeholder="Song Title" id="title">
                <input type="number" name="" class="form-control" placeholder="Word Length" max="99" id="api-length">
                <blockquote id="lyric-blockquote" class="form-control" style="background-color: rgba(204, 203, 203, 0.272);"><br><br><br><br></blockquote>
                <button class="btn btn-dark btn-block" type="submit" id="apiBtn">Find</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    <div class="col-md-5">
      <div class="output text-left">
        <p id="output-text">Output Lyrics here</p>
      </div>
    </div>
    </div>

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    window.onload=function(){
      let eightLtrArr = [];

        function findAllLettersInArr() {
                var lyrics = document.getElementById('test-input').value;
                var length = document.getElementById('length').value;
                console.log("length is " + length);
                if (!lyrics || !length) {
                    alert("Please enter both lyrics and word length.");
                    return;
                }

                let cleanedLyrics = lyrics.replace(/[\r\n]+/g, ' ').replace(/[^a-zA-Z0-9 ]/g, '');
                let lyricArr = cleanedLyrics.split(/\s+/).filter(Boolean);

                let trimSelectedOutputArr = [];
                for (let i = 0; i < lyricArr.length; i++) {
                    if (lyricArr[i].length == length) {
                        trimSelectedOutputArr.push(lyricArr[i]);
                    }
                }

                trimSelectedOutputArr = [...new Set(trimSelectedOutputArr)];

                if (trimSelectedOutputArr.length < 1) {
                    return "no " + length + " letter words";
                }

                return trimSelectedOutputArr.join("\r\n");
            }

          var findBtn = document.getElementById('find-btn');
          findBtn.addEventListener('click', function(event) {
            event.preventDefault();
            eightLtrArr = []; 
            var lyricTextInput = document.getElementById('test-input').value;
            document.getElementById("output-text").innerHTML = "Results: <br>" + findAllLettersInArr();
          });

          function googleLyrics() {
            const artist = document.getElementById('artist').value;
            const title = document.getElementById('title').value;
            const query = `${artist} ${title} lyrics`;
            const url = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
            document.getElementById('output-text').innerHTML = '';
            window.open(url, '_blank');
          }

          function lyricLookupAPI() {
              const artist = document.getElementById('artist').value;
              const title = document.getElementById('title').value;
              const output = document.getElementById('lyric-blockquote');
              const length = document.getElementById('api-length').value;
              const returnedLyrics = document.getElementById('test-input').value;

              if (!artist || !title || !length) {
                  // output.textContent = "Please enter all fields.";
                  alert("Please enter all fields.");
                  return;
          }

            output.textContent = "Fetching lyrics...";
            // returnedLyrics = "fetching lyrics...";
            console.log("artist: " + artist + " title: " + title);
            console.log("fetching lyrics...");

            fetch(`https://api.lyrics.ovh/v1/${encodeURIComponent(artist)}/${encodeURIComponent(title)}`)
              .then(res => res.json())
              .then(data => {
                if (data.lyrics) {
                    output.textContent = data.lyrics;
                    apiLetter();
                } else {
                    // output.textContent = "Lyrics not found. Try searching on Google.";
                    alert("Lyrics not found. Try searching on Google.");
                    const outputText = document.getElementById("output-text");
                    outputText.innerHTML = ''; // Clear output txt
                    outputText.innerHTML = '<button id="google-search-btn">Search on Google</button>';
                    document.getElementById("google-search-btn").addEventListener('click', googleLyrics);
                  }

              })
                .catch(err => {
                  // returnedLyrics = "Error fetching lyrics.";
                    output.textContent = "Error fetching lyrics.";
                    console.error(err);
                });
          }

            function apiLetter() {
                var lyrics = document.getElementById('lyric-blockquote').textContent;
                var length = document.getElementById('api-length').value;
                console.log("length is " + length);
                  if (!length) {
                      alert("Please enter word length.");
                      return;
                  }

                let cleanedLyrics = lyrics.replace(/[\r\n]+/g, ' ').replace(/[^a-zA-Z0-9 ]/g, '');
                let lyricArr = cleanedLyrics.split(/\s+/).filter(Boolean);

                let trimmedArrAPI = [];
                  for (let i = 0; i < lyricArr.length; i++) {
                      if (lyricArr[i].length == length) {
                          trimmedArrAPI.push(lyricArr[i]);
                      }
                  }

                trimmedArrAPI = [...new Set(trimmedArrAPI)];

                  if (trimmedArrAPI.length < 1) {
                      document.getElementById("output-text").innerHTML = "no " + length + " letter words";
                  } else {
                      document.getElementById("output-text").innerHTML = "Results: <br>" + trimmedArrAPI.join("\r\n");
                  }
              }

            var apiBtn = document.getElementById('apiBtn');
            apiBtn.addEventListener('click', function(event) {
                event.preventDefault();
                lyricLookupAPI();
              });

        window.addEventListener("load", findAllLettersInArr); 
        }
  </script>
</body>
